#!/bin/bash
# masterscript uses config pipeline for all 62 counties
source config.properties

shopt -s nullglob
for filename in "${raw_dir}"/*; do
  cp "${filename}" "${txt_dir}"
done

for county in "${pdfCounties[@]}"; do
  for filename in "${txt_dir}"/"${county}"*.pdf; do
    echo "Converting ${filename} to .txt"
    pdftotext -layout "${filename}"
  done
done

# Needs the sleep because the conversion can take a few seconds, and without the sleep the next
# script in the pipeline will start before the previous finishes.
for county in "${xlsxCounties[@]}"; do
  for filename in "${txt_dir}"/"${county}"*.xlsx; do
    echo "Converting ${filename} to .csv"
    libreoffice --headless --convert-to csv "${filename}"
    sleep 5
  done
done

./ParseFiles
./CreateSQLFile
